{% extends 'base.html' %}
{% block title %}Add Certification{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto bg-white/90 p-10 rounded-2xl shadow-xl border border-blue-100">
    <h2 class="text-3xl font-extrabold mb-8 text-blue-700 text-center">Add Certification</h2>
    <form method="post" enctype="multipart/form-data" class="space-y-6" action="{% url 'add_certification' %}">
        {% csrf_token %}
        {{ form.non_field_errors }}
        {% for field in form %}
            <div class="mb-4">
                <label class="block font-semibold mb-2 text-gray-700">{{ field.label }}
                    {% if field.name == 'category' %}
                        <button type="button" class="ml-2 text-xs text-blue-600 underline hover:text-blue-800 add-modal-btn" data-modal="category">Add New</button>
                    {% endif %}
                    {% if field.name == 'institution' %}
                        <button type="button" class="ml-2 text-xs text-blue-600 underline hover:text-blue-800 add-modal-btn" data-modal="institution">Add New</button>
                    {% endif %}
                    {% if field.name == 'prerequisites' %}
                        <button type="button" class="ml-2 text-xs text-blue-600 underline hover:text-blue-800 add-modal-btn" data-modal="prerequisites">Add New</button>
                    {% endif %}
                    {% if field.name == 'languages' %}
                        <button type="button" class="ml-2 text-xs text-blue-600 underline hover:text-blue-800 add-modal-btn" data-modal="languages">Add New</button>
                    {% endif %}
                </label>
                <div class="relative">
                    {{ field }}
                </div>
                {% if field.help_text %}
                    <p class="text-xs text-gray-400 mt-1">{{ field.help_text }}</p>
                {% endif %}
                {% if field.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ field.errors|striptags }}</p>
                {% endif %}
            </div>
        {% endfor %}
        <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-blue-700 text-white py-3 rounded-lg font-bold shadow hover:from-blue-600 hover:to-blue-800 transition">Add Certification</button>
    </form>

    <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-40 z-40"></div>

    <div id="modal-category" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative">
            <button onclick="closeModal('category')" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700">&times;</button>
            <h3 class="text-lg font-bold mb-4">Add New Category</h3>
            <form id="modal-form-category" method="post" action="/certifications/add-related/category/" class="space-y-4" onsubmit="return submitRelatedForm(event, 'category')">
                {% csrf_token %}
                {{ category_form.as_p }}
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Save</button>
            </form>
        </div>
    </div>

    <div id="modal-institution" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative">
            <button onclick="closeModal('institution')" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700">&times;</button>
            <h3 class="text-lg font-bold mb-4">Add New Institution</h3>
            <form id="modal-form-institution" method="post" action="/certifications/add-related/institution/" class="space-y-4" onsubmit="return submitRelatedForm(event, 'institution')">
                {% csrf_token %}
                {{ institutions_form.as_p }}
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Save</button>
            </form>
        </div>
    </div>

    <div id="modal-prerequisites" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative">
            <button onclick="closeModal('prerequisites')" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700">&times;</button>
            <h3 class="text-lg font-bold mb-4">Add New Prerequisite</h3>
            <form id="modal-form-prerequisites" method="post" action="/certifications/add-related/prerequisites/" class="space-y-4" onsubmit="return submitRelatedForm(event, 'prerequisites')">
                {% csrf_token %}
                {{ prerequisites_form.as_p }}
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Save</button>
            </form>
        </div>
    </div>

    <div id="modal-languages" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative">
            <button onclick="closeModal('languages')" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700">&times;</button>
            <h3 class="text-lg font-bold mb-4">Add New Language</h3>
            <form id="modal-form-languages" method="post" action="/certifications/add-related/languages/" class="space-y-4" onsubmit="return submitRelatedForm(event, 'languages')">
                {% csrf_token %}
                {{ languages_form.as_p }}
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Save</button>
            </form>
        </div>
    </div>
</div>
<script>
    function openModal(field) {
        var modal = document.getElementById('modal-' + field);
        var backdrop = document.getElementById('modal-backdrop');
        if (modal && backdrop) {
            modal.classList.remove('hidden');
            backdrop.classList.remove('hidden');
        }
    }
    function closeModal(field) {
        var modal = document.getElementById('modal-' + field);
        var backdrop = document.getElementById('modal-backdrop');
        if (modal && backdrop) {
            modal.classList.add('hidden');
            backdrop.classList.add('hidden');
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
        var backdrop = document.getElementById('modal-backdrop');
        if (backdrop) {
            backdrop.addEventListener('click', function() {
                document.querySelectorAll('[id^="modal-"]').forEach(function(modal) {
                    modal.classList.add('hidden');
                });
                backdrop.classList.add('hidden');
            });
        }
        document.querySelectorAll('.add-modal-btn').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                var modal = btn.getAttribute('data-modal');
                openModal(modal);
            });
        });
    });
</script>
{% endblock %}
